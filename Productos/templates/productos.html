{% load static %}
<style>
  .card-img-top {
    height: 150px;
    object-fit: cover;
  }
</style>

<div class="container-fluid py-4 bg-dark text-white">
  <h4 class="mb-1">Cat√°logo de Productos</h4>
  <div class="mb-3">
    <button id="btnAgregarProducto" class="btn btn-primary me-2">Agregar</button>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="row" id="contenedor-productos">
        {% for producto in productos %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
          <div class="card bg-dark text-white border-0 shadow-sm h-100">
            <img src="{% static 'img/default-product.png' %}" class="card-img-top" alt="{{ producto.nombre }}">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title mb-1">{{ producto.nombre }}</h6>
              <p class="card-text text-success fw-bold">${{ producto.precio }}</p>
              <div class="mt-auto">
                <a href="#" class="btn btn-sm btn-outline-light w-100 mb-2"><i class="fas fa-eye"></i> Ver detalles</a>
                <a href="{% url 'editar_producto' producto.pk %}" class="btn btn-sm btn-outline-warning w-100 mb-2"><i class="fas fa-edit"></i> Modificar</a>
                <form action="{% url 'eliminar_producto' producto.pk %}" method="POST" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger w-100"><i class="fas fa-trash"></i> Eliminar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <p>No hay productos cargados.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
$(document).ready(function() {
  $('#btnAgregarProducto').off('click').on('click', function() {
    const url = "{% url 'formp' %}";
    bootbox.dialog({
      title: 'Formulario',
      message: "<iframe id='formIframe' src='" + url + "' scrolling='yes' frameborder='0' width='100%' height='600'></iframe>",
      size: 'large',
      buttons: {
        cancel: {
          label: 'Cerrar',
          className: 'btn-secondary',
          callback: function () {
            cargarContenido("{% url 'lista_productos' %}");
          }
        }
      }
    });

    window.addEventListener('message', function(event) {
      if (event.data && event.data.action === 'closeBootbox') {
        bootbox.hideAll();
        cargarContenido("{% url 'lista_productos' %}");
      }
    }, { once: true });
  });
});
</script>